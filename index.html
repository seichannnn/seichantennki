<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天気予報アプリ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS (地図用) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- React, ReactDOM, and Lucide Icons via Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>
    
    <!-- Leaflet JS (地図用) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Babel for transforming JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* カスタムアニメーション定義（軽量化設定） */
        @keyframes blob {
          0% { transform: translate(0px, 0px) scale(1); }
          33% { transform: translate(30px, -50px) scale(1.1); }
          66% { transform: translate(-20px, 20px) scale(0.9); }
          100% { transform: translate(0px, 0px) scale(1); }
        }
        @keyframes gradient-slow {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }
        .animate-blob {
          animation: blob 10s infinite; /* 負荷軽減のためゆっくりに */
        }
        .animate-gradient-slow {
          animation: gradient-slow 20s ease infinite; /* 負荷軽減のためゆっくりに */
        }
        .animation-delay-2000 {
          animation-delay: 2s;
        }
        .animation-delay-4000 {
          animation-delay: 4s;
        }
        .glass-card {
           background: rgba(255, 255, 255, 0.35); /* 透明度を上げて描画負荷軽減 */
           box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
           backdrop-filter: blur(8px); /* ぼかしを弱めて軽量化 */
           -webkit-backdrop-filter: blur(8px);
           border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .text-glow {
            text-shadow: 0 0 5px rgba(255,255,255,0.5); /* 影をシンプルに */
        }
        /* スクロールバー非表示 */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* マスクイメージ */
        .mask-image-gradient {
            mask-image: linear-gradient(to right, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, black 85%, transparent 100%);
        }
        /* Leaflet地図のスタイル */
        .leaflet-container {
            background: transparent !important;
            font-family: sans-serif;
            z-index: 0;
        }
        .leaflet-control-attribution {
            background: rgba(255, 255, 255, 0.7) !important;
            border-radius: 4px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Search, Wind, MapPin, Calendar, Sun, Cloud, CloudRain, CloudSnow, CloudLightning, CloudFog, Loader2, Thermometer, LocateFixed, Droplets, User, Star, X, Sparkles, Map as MapIcon, CloudRain as RadarIcon } from 'lucide-react';

        // 雨雲レーダーコンポーネント
        const RadarMap = ({ lat, lon }) => {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const radarLayerRef = useRef(null);

            useEffect(() => {
                if (!mapRef.current) return;

                // 地図の初期化
                if (!mapInstanceRef.current) {
                    mapInstanceRef.current = L.map(mapRef.current, {
                        center: [lat, lon],
                        zoom: 9,
                        zoomControl: false,
                        attributionControl: false
                    });

                    // ベースマップ（OpenStreetMap）
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        opacity: 0.6,
                    }).addTo(mapInstanceRef.current);
                    
                    // クレジット
                    L.control.attribution({
                        position: 'bottomright',
                        prefix: false
                    }).addAttribution('&copy; OSM, RainViewer').addTo(mapInstanceRef.current);

                    // 現在地ピン
                    const icon = L.divIcon({
                        className: 'custom-div-icon',
                        html: `<div style="background-color: #3b82f6; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 10px #3b82f6;"></div>`,
                        iconSize: [12, 12],
                        iconAnchor: [6, 6]
                    });
                    L.marker([lat, lon], { icon }).addTo(mapInstanceRef.current);
                } else {
                    mapInstanceRef.current.setView([lat, lon], 9);
                }

                // RainViewerから雨雲データを取得
                const fetchRadar = async () => {
                    try {
                        const response = await fetch('https://api.rainviewer.com/public/weather-maps.json');
                        const data = await response.json();
                        
                        // 最新の過去データを使用
                        const latestPath = data.radar.past[data.radar.past.length - 1].path;
                        
                        if (radarLayerRef.current) {
                            mapInstanceRef.current.removeLayer(radarLayerRef.current);
                        }

                        radarLayerRef.current = L.tileLayer(`https://tile.rainviewer.com${latestPath}/256/{z}/{x}/{y}/2/1_1.png`, {
                            opacity: 0.7,
                            zIndex: 100
                        }).addTo(mapInstanceRef.current);

                    } catch (error) {
                        console.error("Radar fetch error:", error);
                    }
                };

                fetchRadar();

                return () => {
                    // インスタンスは保持
                };
            }, [lat, lon]);

            return (
                <div className="w-full h-full rounded-3xl overflow-hidden relative z-0">
                    <div ref={mapRef} className="w-full h-full bg-white/50" />
                    <div className="absolute bottom-4 left-4 bg-white/80 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-bold text-gray-600 shadow-sm z-[400] pointer-events-none">
                        現在の雨雲
                    </div>
                </div>
            );
        };

        function App() {
            const [city, setCity] = useState('東京');
            const [weatherData, setWeatherData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [favorites, setFavorites] = useState([]);
            // 表示モード切替用 ('weather' または 'radar')
            const [viewMode, setViewMode] = useState('weather');
            // 地図用の座標
            const [coords, setCoords] = useState({ lat: 35.6895, lon: 139.6917 });

            // 天気コードをアイコンと日本語の説明に変換する関数
            const getWeatherIcon = (code) => {
                if (code === 0) return { icon: <Sun className="w-24 h-24 text-yellow-300 animate-spin-slow drop-shadow-md" />, label: '快晴', bg: 'from-orange-400 via-amber-300 to-yellow-200', text: 'text-yellow-100', accent: 'bg-yellow-400/30' };
                if (code >= 1 && code <= 3) return { icon: <Cloud className="w-24 h-24 text-white drop-shadow-md" />, label: '晴れ/曇り', bg: 'from-blue-400 via-sky-300 to-indigo-100', text: 'text-white', accent: 'bg-white/20' };
                if (code >= 45 && code <= 48) return { icon: <CloudFog className="w-24 h-24 text-gray-100 drop-shadow-md" />, label: '霧', bg: 'from-gray-600 via-slate-400 to-gray-200', text: 'text-gray-100', accent: 'bg-gray-400/30' };
                if (code >= 51 && code <= 67) return { icon: <CloudRain className="w-24 h-24 text-blue-200 drop-shadow-md" />, label: '雨', bg: 'from-blue-800 via-blue-600 to-cyan-500', text: 'text-blue-100', accent: 'bg-blue-500/30' };
                if (code >= 71 && code <= 77) return { icon: <CloudSnow className="w-24 h-24 text-white drop-shadow-md" />, label: '雪', bg: 'from-indigo-500 via-purple-400 to-pink-200', text: 'text-white', accent: 'bg-white/20' };
                if (code >= 80 && code <= 82) return { icon: <CloudRain className="w-24 h-24 text-blue-300 drop-shadow-md" />, label: 'にわか雨', bg: 'from-sky-700 via-blue-500 to-sky-300', text: 'text-sky-100', accent: 'bg-sky-400/30' };
                if (code >= 85 && code <= 86) return { icon: <CloudSnow className="w-24 h-24 text-white drop-shadow-md" />, label: '雪', bg: 'from-gray-500 via-gray-300 to-white', text: 'text-gray-100', accent: 'bg-gray-400/30' };
                if (code >= 95 && code <= 99) return { icon: <CloudLightning className="w-24 h-24 text-yellow-300 drop-shadow-md" />, label: '雷雨', bg: 'from-slate-900 via-purple-900 to-slate-700', text: 'text-yellow-200', accent: 'bg-yellow-500/20' };
                
                return { icon: <Cloud className="w-24 h-24 text-gray-200" />, label: '不明', bg: 'from-blue-400 to-blue-200', text: 'text-white', accent: 'bg-white/20' };
            };

            const fetchWeather = async (cityName) => {
                setLoading(true);
                setError(null);
                try {
                const geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(cityName)}&count=1&language=ja&format=json`;
                const geoRes = await fetch(geoUrl);
                const geoData = await geoRes.json();
            
                if (!geoData.results || geoData.results.length === 0) {
                    throw new Error('見つかりませんでした');
                }
            
                const { latitude, longitude, name } = geoData.results[0];
                
                await fetchWeatherCommon(latitude, longitude, name);
            
                } catch (err) {
                setError(err.message);
                setLoading(false);
                }
            };

            const fetchWeatherByCoords = async (latitude, longitude) => {
                setLoading(true);
                setError(null);
                try {
                let cityName = '現在地';
                try {
                    const geoRes = await fetch(
                    `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=ja`
                    );
                    const geoData = await geoRes.json();
                    cityName = geoData.city || geoData.locality || geoData.principalSubdivision || '現在地';
                } catch (e) {
                    console.warn("地名取得失敗:", e);
                }

                await fetchWeatherCommon(latitude, longitude, cityName);

                } catch (err) {
                setError('天気の取得に失敗しました');
                setLoading(false);
                }
            };

            const fetchWeatherCommon = async (latitude, longitude, cityName) => {
                try {
                // 座標を更新（地図用）
                setCoords({ lat: latitude, lon: longitude });

                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=auto`;
                const weatherRes = await fetch(weatherUrl);
                const weatherData = await weatherRes.json();

                setWeatherData({
                    city: cityName,
                    current: {
                    weathercode: weatherData.current.weather_code,
                    temperature: weatherData.current.temperature_2m,
                    windspeed: weatherData.current.wind_speed_10m,
                    humidity: weatherData.current.relative_humidity_2m,
                    apparent_temp: weatherData.current.apparent_temperature
                    },
                    daily: weatherData.daily,
                });
                setCity(cityName);
                
                localStorage.setItem('weatherAppLastCity', cityName);
                } catch (err) {
                throw err;
                } finally {
                setLoading(false);
                }
            };

            const handleCurrentLocation = () => {
                if (!navigator.geolocation) {
                setError('お使いのブラウザは位置情報をサポートしていません');
                return;
                }

                setLoading(true);
                navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    fetchWeatherByCoords(latitude, longitude);
                },
                (err) => {
                    setLoading(false);
                    setError('位置情報の取得に失敗しました。許可されているか確認してください。');
                }
                );
            };

            useEffect(() => {
                const savedCity = localStorage.getItem('weatherAppLastCity');
                fetchWeather(savedCity || 'Tokyo');
                const savedFavorites = localStorage.getItem('weatherAppFavorites');
                if (savedFavorites) {
                setFavorites(JSON.parse(savedFavorites));
                }
            }, []);

            const toggleFavorite = () => {
                if (!weatherData) return;
                let newFavorites;
                if (favorites.includes(weatherData.city)) {
                newFavorites = favorites.filter(c => c !== weatherData.city);
                } else {
                newFavorites = [...favorites, weatherData.city];
                }
                setFavorites(newFavorites);
                localStorage.setItem('weatherAppFavorites', JSON.stringify(newFavorites));
            };

            const removeFavorite = (e, targetCity) => {
                e.stopPropagation();
                const newFavorites = favorites.filter(c => c !== targetCity);
                setFavorites(newFavorites);
                localStorage.setItem('weatherAppFavorites', JSON.stringify(newFavorites));
            };

            const handleSearch = (e) => {
                e.preventDefault();
                if (searchTerm.trim()) {
                fetchWeather(searchTerm);
                setSearchTerm('');
                }
            };

            const currentWeatherStyle = weatherData 
                ? getWeatherIcon(weatherData.current.weathercode) 
                : { bg: 'from-blue-500 to-cyan-400', text: 'text-white', accent: 'bg-white/20' };
                
            const isFavorite = weatherData && favorites.includes(weatherData.city);

            return (
                <div className={`min-h-screen relative overflow-hidden bg-gradient-to-br ${currentWeatherStyle.bg} bg-[length:400%_400%] animate-gradient-slow transition-all duration-1000 ease-in-out flex items-center justify-center font-sans p-4`}>
                
                {/* 背景: アニメーションを軽量化 */}
                <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
                    <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-white/10 rounded-full mix-blend-overlay blur-[80px] animate-blob"></div>
                    <div className="absolute bottom-[-20%] left-[20%] w-[50%] h-[50%] bg-white/10 rounded-full mix-blend-overlay blur-[80px] animate-blob animation-delay-4000"></div>
                </div>

                <div className="w-full max-w-md glass-card rounded-[3rem] overflow-hidden relative z-10 transition-all duration-500 hover:shadow-[0_20px_60px_rgba(0,0,0,0.5)] transform border-t border-l border-white/50 flex flex-col max-h-[90vh]">
                    
                    {/* Header - Fixed Height */}
                    <div className="p-6 pb-2 relative shrink-0 z-20">
                        <form onSubmit={handleSearch} className="relative flex items-center gap-3 group mb-4">
                            <div className="relative flex-1 group/input">
                            <div className="absolute inset-0 bg-white/30 rounded-full blur-md group-hover/input:bg-white/50 transition-all duration-300"></div>
                            <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-white/70 w-5 h-5 transition-colors group-focus-within/input:text-white z-20" />
                            <input
                                type="text"
                                placeholder="都市名を入力..."
                                className="w-full pl-12 pr-4 py-4 rounded-full bg-white/20 border border-white/30 focus:border-white/80 focus:bg-white/30 focus:ring-2 focus:ring-white/50 outline-none text-white placeholder-white/60 transition-all duration-300 shadow-lg backdrop-blur-sm font-bold relative z-10"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                            </div>
                            
                            <button 
                            type="submit" 
                            className="bg-white/20 hover:bg-white/40 text-white p-4 rounded-full transition-all duration-300 shadow-lg hover:shadow-white/20 hover:scale-110 active:scale-95 disabled:opacity-50 border border-white/30 backdrop-blur-md"
                            disabled={loading}
                            title="検索"
                            >
                            {loading ? <Loader2 className="w-5 h-5 animate-spin" /> : <Search className="w-5 h-5 stroke-[3px]" />}
                            </button>

                            <button 
                            type="button"
                            onClick={handleCurrentLocation}
                            className="bg-white/20 hover:bg-white/40 text-white p-4 rounded-full transition-all duration-300 shadow-lg hover:shadow-white/20 hover:scale-110 active:scale-95 disabled:opacity-50 border border-white/30 backdrop-blur-md"
                            disabled={loading}
                            title="現在地を取得"
                            >
                            <LocateFixed className="w-5 h-5 stroke-[3px]" />
                            </button>
                        </form>

                        {/* Favorites */}
                        {favorites.length > 0 && (
                            <div className="flex flex-wrap gap-2 mb-2 overflow-x-auto pb-2 scrollbar-hide mask-image-gradient">
                            {favorites.map(favCity => (
                                <button
                                key={favCity}
                                onClick={() => fetchWeather(favCity)}
                                className={`group flex items-center space-x-1 px-4 py-2 rounded-full text-sm font-bold transition-all duration-300 border shadow-md hover:scale-105 active:scale-95
                                    ${city === favCity 
                                    ? 'bg-white text-blue-600 border-white ring-2 ring-white/50 shadow-lg' 
                                    : 'bg-black/20 text-white border-white/10 hover:bg-black/30'}`}
                                >
                                <Star className={`w-3 h-3 ${city === favCity ? 'fill-blue-500 text-blue-500' : 'text-yellow-300 fill-yellow-300'}`} />
                                <span>{favCity}</span>
                                <div 
                                    onClick={(e) => removeFavorite(e, favCity)}
                                    className="ml-2 p-0.5 rounded-full hover:bg-red-500/80 hover:text-white transition-colors"
                                >
                                    <X className="w-3 h-3" />
                                </div>
                                </button>
                            ))}
                            </div>
                        )}

                        {error && (
                            <div className="mb-2 p-4 bg-red-500/20 backdrop-blur-md border border-red-500/50 text-white font-bold rounded-2xl text-sm flex items-center animate-bounce shadow-lg">
                            <span className="mr-3 text-2xl">⚠️</span> {error}
                            </div>
                        )}

                        {/* 切り替えタブ */}
                        {weatherData && (
                            <div className="flex bg-black/20 p-1 rounded-full mb-2 border border-white/10 backdrop-blur-md">
                                <button
                                    onClick={() => setViewMode('weather')}
                                    className={`flex-1 py-2 rounded-full text-sm font-bold flex items-center justify-center gap-2 transition-all duration-300 ${viewMode === 'weather' ? 'bg-white text-blue-600 shadow-md' : 'text-white/70 hover:text-white'}`}
                                >
                                    <Sun className="w-4 h-4" /> 天気予報
                                </button>
                                <button
                                    onClick={() => setViewMode('radar')}
                                    className={`flex-1 py-2 rounded-full text-sm font-bold flex items-center justify-center gap-2 transition-all duration-300 ${viewMode === 'radar' ? 'bg-white text-blue-600 shadow-md' : 'text-white/70 hover:text-white'}`}
                                >
                                    <RadarIcon className="w-4 h-4" /> 雨雲レーダー
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Content Area */}
                    <div className="flex-1 overflow-y-auto scrollbar-hide">
                        {weatherData && !loading ? (
                        <div className="animate-in fade-in slide-in-from-bottom-8 duration-500 h-full flex flex-col">
                            
                            {viewMode === 'weather' ? (
                                /* 天気予報画面 */
                                <>
                                    <div className="px-8 pb-8 pt-2 text-center relative">
                                        <div className="inline-flex items-center space-x-3 bg-black/10 px-6 py-2 rounded-full border border-white/20 backdrop-blur-md shadow-lg mb-8 hover:bg-black/20 transition-colors cursor-default">
                                            <MapPin className="w-5 h-5 text-white" />
                                            <h2 className="text-xl font-black tracking-widest text-white text-glow">{weatherData.city}</h2>
                                            <div className="w-px h-4 bg-white/30 mx-2"></div>
                                            <button 
                                            onClick={toggleFavorite}
                                            className="p-1.5 rounded-full hover:bg-white/20 transition-all duration-300 hover:scale-125 focus:outline-none active:scale-90"
                                            >
                                            <Star className={`w-6 h-6 transition-colors duration-300 filter drop-shadow-md ${isFavorite ? "fill-yellow-400 text-yellow-400" : "text-white/60 hover:text-yellow-300"}`} />
                                            </button>
                                        </div>
                                        
                                        <div className="flex flex-col items-center justify-center mb-10 relative">
                                            <div className="transform transition-transform hover:scale-125 duration-500 cursor-pointer z-10 filter drop-shadow-md">
                                            {getWeatherIcon(weatherData.current.weathercode).icon}
                                            </div>
                                            
                                            <div className="relative mt-2">
                                                <h1 className="text-9xl font-black tracking-tighter text-white drop-shadow-md text-glow scale-y-110">
                                                {Math.round(weatherData.current.temperature)}
                                                <span className="text-5xl align-top absolute top-2 -right-12">°</span>
                                                </h1>
                                            </div>
                                            
                                            <p className="text-2xl font-black mt-2 text-white tracking-widest bg-black/10 px-8 py-2 rounded-full shadow-inner backdrop-blur-sm border border-white/10">
                                            {getWeatherIcon(weatherData.current.weathercode).label}
                                            </p>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4 mb-4">
                                            {[
                                            { icon: <Wind className="w-5 h-5" />, label: "風速", value: weatherData.current.windspeed, unit: "km/h", color: "text-blue-200" },
                                            { icon: <Droplets className="w-5 h-5" />, label: "湿度", value: weatherData.current.humidity, unit: "%", color: "text-cyan-200" },
                                            { icon: <User className="w-5 h-5" />, label: "体感", value: Math.round(weatherData.current.apparent_temp), unit: "°", color: "text-orange-200" },
                                            { icon: <Calendar className="w-5 h-5" />, label: "日付", value: new Date().getDate(), unit: "日", color: "text-purple-200" }
                                            ].map((stat, idx) => (
                                            <div key={idx} className="group bg-black/10 hover:bg-black/20 p-4 rounded-3xl border border-white/10 shadow-lg hover:shadow-xl transition-all duration-300 flex flex-col items-center justify-center hover:-translate-y-1">
                                                <div className="flex items-center space-x-2 mb-2 opacity-80 group-hover:opacity-100 transition-opacity">
                                                <div className={`${stat.color}`}>{stat.icon}</div>
                                                <span className="text-white/70 text-xs font-bold uppercase tracking-widest">{stat.label}</span>
                                                </div>
                                                <span className="text-white font-black text-2xl tracking-wide drop-shadow-md">
                                                {stat.value} <span className="text-sm font-medium text-white/60">{stat.unit}</span>
                                                </span>
                                            </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="p-6 bg-black/20 backdrop-blur-xl rounded-t-[3rem] shadow-[inset_0_1px_1px_rgba(255,255,255,0.2)] border-t border-white/10">
                                        <h3 className="text-white/60 text-xs font-black uppercase tracking-[0.2em] mb-6 pl-4 flex items-center">
                                            <Sparkles className="w-4 h-4 mr-2 text-yellow-300" /> 週間予報
                                        </h3>
                                        <div className="space-y-3">
                                            {weatherData.daily.time.slice(1, 6).map((date, index) => {
                                            const code = weatherData.daily.weather_code[index + 1];
                                            const maxTemp = weatherData.daily.temperature_2m_max[index + 1];
                                            const minTemp = weatherData.daily.temperature_2m_min[index + 1];
                                            const iconInfo = getWeatherIcon(code);
                                            
                                            return (
                                                <div key={date} className="group relative flex items-center justify-between bg-white/5 hover:bg-white/20 p-4 rounded-2xl transition-all duration-300 border border-white/5 hover:border-white/20 overflow-hidden hover:shadow-lg hover:scale-[1.02]">
                                                <div className={`absolute inset-0 opacity-0 group-hover:opacity-20 bg-gradient-to-r ${iconInfo.bg} transition-opacity duration-300`}></div>
                                                
                                                <div className="flex items-center space-x-4 w-1/3 relative z-10">
                                                    <span className="text-white font-bold text-sm bg-black/20 px-3 py-1 rounded-lg group-hover:bg-white group-hover:text-black transition-colors shadow-sm">
                                                    {new Date(date).toLocaleDateString('ja-JP', { weekday: 'short' })}
                                                    </span>
                                                    <div className="transform group-hover:scale-125 transition-transform duration-300 filter drop-shadow-md">
                                                    {React.cloneElement(iconInfo.icon, { className: `w-10 h-10 ${iconInfo.text.replace('text-', 'text-')}` })}
                                                    </div>
                                                </div>
                                                
                                                <div className="text-white/80 text-xs w-1/3 text-center font-bold tracking-wider relative z-10">
                                                    {iconInfo.label}
                                                </div>

                                                <div className="flex items-center justify-end space-x-6 w-1/3 relative z-10">
                                                    <div className="text-center">
                                                        <span className="block font-black text-white text-lg leading-none drop-shadow-sm">{Math.round(maxTemp)}°</span>
                                        <span className="text-[10px] text-white/50 font-medium">High</span>
                                                    </div>
                                                    <div className="w-px h-8 bg-white/20"></div>
                                                    <div className="text-center">
                                                        <span className="block font-bold text-white/70 text-lg leading-none">{Math.round(minTemp)}°</span>
                                                        <span className="text-[10px] text-white/30 font-medium">Low</span>
                                                    </div>
                                                </div>
                                                </div>
                                            );
                                            })}
                                        </div>
                                    </div>
                                </>
                            ) : (
                                /* 雨雲レーダー画面 */
                                <div className="p-4 h-full flex flex-col">
                                    <div className="inline-flex items-center justify-center space-x-3 bg-black/10 px-6 py-2 rounded-full border border-white/20 backdrop-blur-md shadow-lg mb-4 hover:bg-black/20 transition-colors cursor-default mx-auto">
                                        <MapPin className="w-5 h-5 text-white" />
                                        <h2 className="text-xl font-black tracking-widest text-white text-glow">{weatherData.city} 周辺</h2>
                                    </div>
                                    <div className="flex-1 min-h-[400px] w-full bg-white/20 rounded-3xl border border-white/20 shadow-inner overflow-hidden relative">
                                        <RadarMap lat={coords.lat} lon={coords.lon} />
                                    </div>
                                    <p className="text-white/60 text-xs text-center mt-4 font-bold">
                                        データ提供: OpenStreetMap, RainViewer
                                    </p>
                                </div>
                            )}

                        </div>
                        ) : (
                        <div className="flex flex-col items-center justify-center h-full relative p-12">
                            {loading ? (
                            <div className="relative flex flex-col items-center z-10">
                                <div className="absolute inset-0 bg-blue-500 blur-[80px] opacity-20 animate-pulse rounded-full"></div>
                                <Loader2 className="w-20 h-20 text-white animate-spin drop-shadow-md" />
                                <p className="text-white font-black mt-8 text-center animate-pulse tracking-[0.3em] text-lg text-glow">LOADING DATA...</p>
                            </div>
                            ) : (
                            <div className="text-white/50 text-center px-8 z-10">
                                <Sun className="w-24 h-24 mx-auto mb-6 text-white/30 animate-spin-slow" />
                                <p className="font-bold text-lg tracking-wider">都市名を入力して天気を検索</p>
                                <p className="text-sm mt-2 opacity-60">世界中の天気がわかります</p>
                            </div>
                            )}
                        </div>
                        )}
                    </div>
                </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>